from telegram import Update, ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton, InputFile
from telegram.ext import Updater, CommandHandler, MessageHandler, CallbackQueryHandler, Filters
from datetime import datetime
import time
import asyncio
import os

BOT_TOKEN = os.getenv("BOT_TOKEN")
BASE_URL = "https://tsue.edupage.org/timetable/view.php?num=90&class=*"

STRINGS = {
    "uz": {
        "welcome": "üéì *TSUE Dars Jadvali Bot*\n\nAssalomu alaykum! üëã\n\nüìå Ushbu bot orqali siz *dars jadvalingizni rasm ko‚Äòrinishida* ko‚Äòrishingiz mumkin.\n\nüëâ Boshlash uchun:\nüîç *Guruh Tanlash* tugmasini bosing\nyoki guruh nomini yozing (masalan: `RST-88/25`).\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë®‚Äçüíª Yaratuvchi: @sqosimovv",
        "btn_bugun": "üìÖ Bugun",
        "btn_guruh": "üîç Guruh Tanlash",
        "btn_yordam": "‚ÑπÔ∏è Yordam",
        "btn_lang": "üåê Tilni o'zgartirish",
        "btn_notif": "üîî Eslatmalar",
        "btn_notif_on": "‚úÖ Yoqish",
        "btn_notif_off": "‚ùå O'chirish",
        "btn_back": "‚¨ÖÔ∏è Orqaga",
        "notif_menu": "üîî *Eslatmalar bo'limi*\n\nHolat: {}\n\nHar kuni soat 08:00 da dars jadvalingizni avtomatik olishni xohlaysizmi?",
        "notif_status_on": "Yoqilgan",
        "notif_status_off": "O'chirilgan",
        "notif_enabled": "‚úÖ Eslatmalar yoqildi! Har kuni 08:00 da dars jadvali yuboriladi.",
        "notif_disabled": "‚ùå Eslatmalar o'chirildi.",
        "select_group": "Guruh nomini yozing:\nMasalan: `RST-88/25`",
        "group_selected": "‚úÖ *{}* tanlandi!\n\nüìÖ 'Bugun' tugmasini bosing.",
        "no_group": "‚ùå Avval guruh tanlang!",
        "group_not_found": "‚ö†Ô∏è {} topilmadi. To‚Äòg‚Äòri yozing.",
        "taking_screenshot": "üì∏ Jadval rasmi olinmoqda...",
        "error_screenshot": "‚ùå Rasm olinmadi\n\nXatolik: {}\n\nüîó Saytda ko‚Äòring:",
        "error_sending": "‚ùå Rasm yuborishda xatolik: {}",
        "today_caption": "üìÖ *Bugungi jadval*\nüë• *{}*\nüìÜ {}\n\nüîó [Saytda ko‚Äòrish]({})",
        "help_text": "üÜò *YORDAM BO‚ÄòLIMI*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüéì *Bu bot nima qiladi?*\n‚Äî TSUE talabalari uchun *dars jadvalini rasm ko‚Äòrinishida* chiqarib beradi.\n\nüìå *Qanday foydalaniladi?*\n1Ô∏è‚É£ `üîç Guruh Tanlash` ‚Äî guruhingizni tanlang\n2Ô∏è‚É£ Yoki guruh nomini yozing (masalan: `RST-88/25`)\n3Ô∏è‚É£ `üìÖ Bugun` tugmasini bosing\n\nüì∏ Natija:\n‚Äî Bugungi darslar *rasm (screenshot)* ko‚Äòrinishida yuboriladi\n\n‚ö†Ô∏è *Eslatma:*\n‚Äî Avval guruh tanlanmasa, jadval chiqmaydi\n‚Äî Guruh nomini to‚Äòg‚Äòri yozing\n\nüë®‚Äçüíª *Aloqa & takliflar:*\nüëâ @sqosimovv\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚ú® Botdan unumli foydalaning!",
        "days": ["Dushanba", "Seshanba", "Chorshanba", "Payshanba", "Juma", "Shanba", "Yakshanba"],
        "lang_selected": "‚úÖ O'zbek tili tanlandi!",
        "choose_lang": "üá∫üáø Tilni tanlang / üá∑üá∫ –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / üá∫üá∏ Choose language:"
    },
    "ru": {
        "welcome": "üéì *–ë–æ—Ç –†–∞—Å–ø–∏—Å–∞–Ω–∏—è –¢–ì–≠–£*\n\n–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã\n\nüìå –° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –≤—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —Å–≤–æ–µ *—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –≤–∏–¥–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è*.\n\nüëâ –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å:\nüîç –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É *–í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã*\n–∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: `RST-88/25`).\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë®‚Äçüíª –°–æ–∑–¥–∞—Ç–µ–ª—å: @sqosimovv",
        "btn_bugun": "üìÖ –°–µ–≥–æ–¥–Ω—è",
        "btn_guruh": "üîç –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã",
        "btn_yordam": "‚ÑπÔ∏è –ü–æ–º–æ—â—å",
        "btn_lang": "üåê –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫",
        "btn_notif": "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è",
        "btn_notif_on": "‚úÖ –í–∫–ª—é—á–∏—Ç—å",
        "btn_notif_off": "‚ùå –í—ã–∫–ª—é—á–∏—Ç—å",
        "btn_back": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
        "notif_menu": "üîî *–†–∞–∑–¥–µ–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π*\n\n–°—Ç–∞—Ç—É—Å: {}\n\n–•–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 08:00?",
        "notif_status_on": "–í–∫–ª—é—á–µ–Ω–æ",
        "notif_status_off": "–í—ã–∫–ª—é—á–µ–Ω–æ",
        "notif_enabled": "‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã! –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 08:00.",
        "notif_disabled": "‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—ã–∫–ª—é—á–µ–Ω—ã.",
        "select_group": "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:\n–ù–∞–ø—Ä–∏–º–µ—Ä: `RST-88/25`",
        "group_selected": "‚úÖ *{}* –≤—ã–±—Ä–∞–Ω–∞!\n\nüìÖ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–°–µ–≥–æ–¥–Ω—è'.",
        "no_group": "‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É!",
        "group_not_found": "‚ö†Ô∏è {} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.",
        "taking_screenshot": "üì∏ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è...",
        "error_screenshot": "‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ\n\n–û—à–∏–±–∫–∞: {}\n\nüîó –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ:",
        "error_sending": "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ: {}",
        "today_caption": "üìÖ *–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è*\nüë• *{}*\nüìÜ {}\n\nüîó [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∞–π—Ç–µ]({})",
        "help_text": "üÜò *–†–ê–ó–î–ï–õ –ü–û–ú–û–©–ò*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüéì *–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç –±–æ—Ç?*\n‚Äî –í—ã–¥–∞–µ—Ç *—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π –≤ –≤–∏–¥–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è* –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¢–ì–≠–£.\n\nüìå *–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?*\n1Ô∏è‚É£ `üîç –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã` ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –≥—Ä—É–ø–ø—É\n2Ô∏è‚É£ –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: `RST-88/25`)\n3Ô∏è‚É£ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É `üìÖ –°–µ–≥–æ–¥–Ω—è` \n\nüì∏ –†–µ–∑—É–ª—å—Ç–∞—Ç:\n‚Äî –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –≤–∏–¥–µ *–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å–∫—Ä–∏–Ω—à–æ—Ç–∞)*\n\n‚ö†Ô∏è *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:*\n‚Äî –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –∑–∞—Ä–∞–Ω–µ–µ, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è\n‚Äî –ü–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n\nüë®‚Äçüíª *–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:*\nüëâ @sqosimovv\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚ú® –ü–æ–ª—å–∑—É–π—Ç–µ—Å—å –±–æ—Ç–æ–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!",
        "days": ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"],
        "lang_selected": "‚úÖ –í—ã–±—Ä–∞–Ω —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫!",
        "choose_lang": "üá∫üáø Tilni tanlang / üá∑üá∫ –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / üá∫üá∏ Choose language:"
    },
    "en": {
        "welcome": "üéì *TSUE Timetable Bot*\n\nHello! üëã\n\nüìå Through this bot, you can see your *timetable as an image*.\n\nüëâ To start:\nüîç Press the *Select Group* button\nor type the group name (e.g., `RST-88/25`).\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüë®‚Äçüíª Creator: @sqosimovv",
        "btn_bugun": "üìÖ Today",
        "btn_guruh": "üîç Select Group",
        "btn_yordam": "‚ÑπÔ∏è Help",
        "btn_lang": "üåê Change Language",
        "btn_notif": "üîî Notifications",
        "btn_notif_on": "‚úÖ Turn ON",
        "btn_notif_off": "‚ùå Turn OFF",
        "btn_back": "‚¨ÖÔ∏è Back",
        "notif_menu": "üîî *Notifications Section*\n\nStatus: {}\n\nDo you want to receive your timetable automatically every day at 08:00?",
        "notif_status_on": "Enabled",
        "notif_status_off": "Disabled",
        "notif_enabled": "‚úÖ Notifications enabled! Timetable will be sent every day at 08:00.",
        "notif_disabled": "‚ùå Notifications disabled.",
        "select_group": "Type the group name:\nFor example: `RST-88/25`",
        "group_selected": "‚úÖ *{}* selected!\n\nüìÖ Press 'Today'.",
        "no_group": "‚ùå Select a group first!",
        "group_not_found": "‚ö†Ô∏è {} not found. Type correctly.",
        "taking_screenshot": "üì∏ Taking timetable screenshot...",
        "error_screenshot": "‚ùå Image failed\n\nError: {}\n\nüîó View on site:",
        "error_sending": "‚ùå Error sending photo: {}",
        "today_caption": "üìÖ *Today's Timetable*\nüë• *{}*\nüìÜ {}\n\nüîó [View on site]({})",
        "help_text": "üÜò *HELP SECTION*\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüéì *What does this bot do?*\n‚Äî Provides the *class schedule as an image* for TSUE students.\n\nüìå *How to use?*\n1Ô∏è‚É£ `üîç Select Group` ‚Äî select your group\n2Ô∏è‚É£ Or type the group name (e.g., `RST-88/25`)\n3Ô∏è‚É£ Press the `üìÖ Today` button\n\nüì∏ Result:\n‚Äî Today's classes will be sent as an *image (screenshot)*\n\n‚ö†Ô∏è *Note:*\n‚Äî If a group is not selected first, the schedule won't appear\n‚Äî Type the group name correctly\n\nüë®‚Äçüíª *Contact & suggestions:*\nüëâ @sqosimovv\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚ú® Use the bot productively!",
        "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
        "lang_selected": "‚úÖ English language selected!",
        "choose_lang": "üá∫üáø Tilni tanlang / üá∑üá∫ –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / üá∫üá∏ Choose language:"
    }
}

# GROUP_IDS lug'ati (Siz bergan versiya)
GROUP_IDS = {
    # MENEJMENT FAKULTETI
    "MENEJMENT FAKULTETI": "1",
    "1 KURS": "2",
    "MNP-80": "3",
    "MNP-81": "4",
    "MNP-82": "5",
    "MNP-83": "6",
    "MNP-84": "7",
    "MNP-85": "8",
    "MNP-86": "9",
    "MNP-87": "10",
    "MNP-88": "11",
    "MNP-89": "12",
    "MNP-80k": "13",
    "MNP-81k": "14",
    "MNP-30/25": "57",
    "MNP-31/25": "58",
    "MNP-38i/25": "65",
    "MO-80/25": "17",
    "MO-81/25": "18",
    "MO-82/25": "19",
    "MO-83/25": "20",
    "MO-84/25": "21",
    "MO-85/25": "22",
    "MO-86/25": "23",
    "MO-87/25": "24",
    "MO-88/25": "25",
    "MO-89/25": "26",
    "MO-80k/25": "27",
    "MO-81k/25": "28",
    "MO-82k/25": "29",
    "MO-83k/25": "30",
    "MO-84k/25": "31",
    "MO-85k/25": "32",
    "MO-86k/25": "33",
    "MO-87k/25": "34",
    "MO-88k/25": "59",
    "MO-89k/25": "60",
    "–ú–û-30/25": "61",
    "–ú–û-31/25": "62",
    "–ú–û-32/25": "63",
    "–ú–û-33/25": "64",
    "–ú–û-34/25": "106",
    "–ú–û-35/25": "108",
    "MO-38i/25": "136",
    "MO-39i/25": "134",
    "LG-80/25": "35",
    "LG-81/25": "36",
    "LG-82/25": "37",
    "LG-83/25": "38",
    "LG-84/25": "39",
    "LG-85/25": "40",
    "BBA-80/25": "43",
    "BBA-81/25": "44",
    "BBA-82/25": "45",
    "BBA-83/25": "46",
    "BBA-84/25": "47",
    "BBA-85/25": "48",
    "BBA-86/25": "49",
    "BBA-87/25": "50",
    "BBA-88/25": "51",
    "BBA-30/25": "55",
    "BBA-31/25": "56",
    "BBA-38i/25": "99",
    
    # 2-KURS (MENEJMENT)
    "2 KURS": "66",
    "MNP-51/24": "67",
    "MNP-52/24": "68",
    "MNP-53/24": "69",
    "MNP-54/24": "70",
    "MNP-55/24": "71",
    "MNP-56/24": "72",
    "MNP-57/24": "73",
    "MO-50/24": "74",
    "MO-59/24": "75",
    "MO-51/24": "76",
    "MO-52/24": "77",
    "MO-53/24": "78",
    "MO-54/24": "79",
    "MO-55/24": "80",
    "MO-56/24": "81",
    "MO-57/24": "82",
    "MO-58/24": "83",
    "MO-11/24r": "93",
    "MO-12/24r": "94",
    "MO-13/24r": "95",
    "MO-14/24r": "96",
    "LG-51/24": "84",
    "LG-52/24": "85",
    "BBA-51/24": "86",
    "BBA-52/24": "87",
    "BBA-53/24": "88",
    "BBA-54/24": "89",
    "BBA-55/24": "90",
    "MNP-11/24r": "91",
    "MNP-12/24r": "92",
    "MNP-21/24i": "102",
    "LG-11/24r": "97",
    "BBA-11/24r": "98",
    "BBA-21/24i": "103",
    "LG-21/24i": "104",
    "MO-21/24i": "100",
    "MO-22/24i": "101",
    
    # 3-KURS (MENEJMENT)
    "3 KURS": "110",
    "MNP-25/23r": "111",
    "MNP-26/23r": "112",
    "MO-25/23r": "113",
    "MO-26/23r": "114",
    "IH-25/23r": "115",
    "MNP-28/23i": "116",
    "KB-28/23i": "117",
    "MO-28/23i": "118",
    "MO-29/23i": "119",
    "BBA-76/23i": "120",
    "LG-76/23i": "121",
    "IH-70/23i": "122",
    "MNP-75/23": "123",
    "MNP-76/23": "124",
    "MO-75/23": "125",
    "MO-76/23": "126",
    "MO-77/23": "127",
    "KB-75/23": "128",
    "KB-76/23": "129",
    "BBA-75/23": "130",
    "LG-75/23": "131",
    "IH-75/23": "132",
    "IH-76/23": "133",
    
    # 4-KURS (MENEJMENT)
    "4 KURS": "138",
    "MNP-01/22r": "139",
    "MO-01/22r": "140",
    "MNP-61/22": "141",
    "MNP-62/22": "142",
    "IH-61/22": "143",
    "KB-61/22": "144",
    "KB-62/22": "145",
    "MO-61/22": "146",
    "MO-62/22": "147",
    "MO-67/22i": "148",
    "MO-68/22i": "149",
    "BBA-60/22i": "150",
    "BBA-61/22": "151",
    "LG-61/22": "152",
    "LG-01/22r": "153",
    "IH-01/22r": "154",
    "IH-60/22i": "155",
    "MNP-67/22i": "156",
    
    # IQTISODIYOT FAKULTETI
    "IQTISODIYOT FAKULTETI": "162",
    "1 KURS": "163",
    "I-80/25": "164",
    "I-81/25": "165",
    "I-82/25": "166",
    "I-83/25": "167",
    "I-84/25": "168",
    "I-85/25": "169",
    "I-86/25": "170",
    "I-87/25": "171",
    "I-88/25": "172",
    "I-89/25": "173",
    "I-80k/25": "174",
    "I-81k/25": "175",
    "I-82k/25": "176",
    "I-83k/25": "177",
    "I-84k/25": "178",
    "I-85k/25": "179",
    "I-86/25i": "180",
    "I-87/25i": "181",
    "I-30/25": "182",
    "I-31/25": "183",
    "I-32/25": "184",
    "I-33/25": "185",
    "I-34/25i": "186",
    "IRB-86/25i": "187",
    "IRB-80/25": "188",
    "IRB-81/25": "189",
    "IRB-82/25": "190",
    "IRB-83/25": "191",
    "IRB-84/25": "192",
    "IRB-85/25": "193",
    
    # IQTISODIYOT 2-KURS
    "2 KURS": "201",
    "I-01/24r": "202",
    "I-02/24r": "203",
    "I-03/24r": "204",
    "I-04/24r": "205",
    "I-50/24": "206",
    "I-51/24": "207",
    "I-52/24": "208",
    "I-53/24": "209",
    "I-54/24": "210",
    "I-55/24": "211",
    "I-56/24": "212",
    "I-57/24": "213",
    "I-58/24": "214",
    "I-59/24": "215",
    "I-50k/24": "216",
    "I-51k/24": "217",
    "I-52k/24": "218",
    "I-53k/24": "219",
    "IRB-50/24": "220",
    "IRB-51/24": "221",
    "IRB-52/24": "222",
    "IRB-53/24i": "223",
    "I-05/24i": "224",
    "I-54/24i": "225",
    "I-55/24i": "226",
    
    # IQTISODIYOT 3-KURS
    "3 KURS": "234",
    "I-24/23i": "235",
    "I-70/23i": "236",
    "I-71/23": "237",
    "I-72/23": "238",
    "I-73/23": "239",
    "I-74/23": "240",
    "I-75/23": "241",
    "I-76/23": "242",
    "I-77/23": "243",
    "I-78/23": "244",
    "I-79/23": "245",
    "I-72k/23": "246",
    "I-71k/23": "247",
    "I-70k/23": "248",
    "I-73k/23": "249",
    "I-74k/23": "250",
    "I-20/23r": "251",
    "I-21/23r": "252",
    "I-22/23r": "253",
    "I-23/23r": "254",
    "IRB-20/23r": "255",
    "BB-20/23r": "256",
    "IRB-75/23": "257",
    "IRB-76/23": "258",
    "MI-75/23": "259",
    "MI-76/23": "260",
    "BB-75/23": "261",
    "YaI-75/23": "262",
    "YaI-76/23": "263",
    "ShI-75/23": "264",
    "TI-75/23": "265",
    "PTI-75/23": "266",
    "PTI-76/23i": "267",
    
    # IQTISODIYOT 4-KURS
    "4 KURS": "270",
    "IRB-10/22r": "271",
    "I-10/22r": "272",
    "I-11/22r": "273",
    "I-12/22r": "274",
    "I-13/22i": "275",
    "I-60/22i": "276",
    "PTI-60/22i": "277",
    "I-60k/22": "278",
    "I-61k/22": "279",
    "I-62k/22": "280",
    "I-61/22": "281",
    "I-62/22": "282",
    "I-63/22": "283",
    "I-64/22": "284",
    "I-65/22": "285",
    "I-66/22": "286",
    "I-67/22": "287",
    "I-68/22": "288",
    "I-69/22": "289",
    "IRB-61/22": "290",
    "IRB-62/22": "291",
    "MI-61/22": "292",
    "MI-62/22": "293",
    "PTI-61/22": "294",
    "PTI-62/22": "295",
    
    # RAQAMLI IQTISODIYOT
    "RAQAMLI IQTISODIYOT": "304",
    "1 KURS": "305",
    "AT-81/25": "306",
    "AT-82/25": "307",
    "AT-83/25": "308",
    "AT-84/25": "309",
    "AT-85/25": "310",
    "AT-86/25": "311",
    "AT-87/25": "312",
    "AT-88/25": "313",
    "IB-81/25": "314",
    "IB-82/25": "315",
    "IB-83/25": "316",
    "IB-84/25": "317",
    "IB-85/25": "318",
    "IB-86/25": "319",
    "IB-87/25": "320",
    "IB-88/25": "321",
    "II-81/25": "322",
    "II-82/25": "323",
    "II-83/25": "324",
    "II-84/25": "325",
    "II-85/25": "326",
    "II-86/25": "327",
    "RST-81/25": "328",
    "RST-82/25": "329",
    "RST-83/25": "330",
    "RST-84/25": "331",
    "RST-85/25": "332",
    "RST-86/25": "333",
    "RST-87/25": "334",
    "RST-88/25": "335",
    "II-31/32": "336",
    "II-32/35": "337",
    "AT-31/35": "338",
    "AT-32/33": "339",
    "IB-31/35": "340",
    "IB-32/34": "341",
    "RST-80 ing/30": "342",
    
    # RAQAMLI IQTISODIYOT 2-KURS
    "2 KURS": "348",
    "AT-11/24r": "349",
    "AT-12/24r": "350",
    "II-11/24r": "351",
    "IB-11/24r": "352",
    "AT-51/24": "353",
    "AT-52/24": "354",
    "AT-53/24": "355",
    "AT-54/24": "356",
    "AT-55/24": "357",
    "AT-56/24": "358",
    "AT-57/24": "359",
    "II-51/24": "361",
    "II-52/24": "362",
    "II-53/24": "363",
    "IB-51/24": "364",
    "IB-52/24": "365",
    "IB-53/24": "366",
    "RST-51/24": "367",
    "RST-52/24": "368",
    "RST-53/24": "369",
    "RST-54/24": "370",
    "RST-50/24i": "372",
    
    # RAQAMLI IQTISODIYOT 3-KURS
    "3 KURS": "378",
    "ATT-25/23r": "379",
    "AT-25/23r": "380",
    "II-25/23r": "381",
    "RI-25/23r": "382",
    "RI-70/i23i": "383",
    "RST-70i/23i": "384",
    "ATT-75/23": "385",
    "ATT-76/23": "386",
    "ATT-77/23": "387",
    "AT-75/23": "388",
    "AT-76/23": "389",
    "IB-75/23": "390",
    "II-75/23": "391",
    "EKR-75/23": "392",
    "BET-75/23": "393",
    "BET-76/23": "394",
    "DS-75/23": "395",
    "RI-75/23": "396",
    "RI-76/23": "397",
    "RST-75/23": "398",
    "RST-76/23": "399",
    "RST-77/23": "400",
    "Tadbir RI 18.12.25": "401",
    
    # RAQAMLI IQTISODIYOT 4-KURS
    "4 KURS": "404",
    "AT-01/22r": "405",
    "RI-01/22r": "406",
    "ATT-01/22r": "407",
    "AT-61/22": "408",
    "AT-62/22": "409",
    "ATT-61/22": "410",
    "ATT-62/22": "411",
    "BET-61/22": "412",
    "BET-62/22": "413",
    "DS-61/22": "414",
    "EKR-61/22": "415",
    "RI-60i/22i": "416",
    "RI-61/22": "417",
    "RI-62/22": "418",
    "RST-61/22": "419",
    "RST-62/22": "420",
    "RST-63/22": "421",
    
    # TURIZM FAKULTETI
    "TURIZM FAKULTETI": "427",
    "1 KURS": "428",
    "MR-79i/25": "426",
    "MR-80i/25": "429",
    "MR-81i/25": "430",
    "MR-82/25": "431",
    "MR-83/25": "432",
    "MR-84/25": "433",
    "MR-85/25": "434",
    "MR-86/25": "435",
    "MR-87/25": "436",
    "MR-88/25": "437",
    "MR-30/25": "438",
    "MR-31/25": "439",
    "MR-32/25": "440",
    "TU-80i25": "441",
    "TU-81i/25": "442",
    "TU-82/25": "443",
    "TU-83/25": "444",
    "TU-84/25": "445",
    "TU-85/25": "446",
    "TU-86/25": "447",
    "TU-87/25": "448",
    "TU-88/25": "449",
    "TU-89/25": "450",
    "TU-80k/25": "451",
    "TU-81k/25": "452",
    "TU-82k/25": "1386",
    "TU-30/25": "453",
    "TU-31/25": "454",
    "TU-32/25": "455",
    "TU-33/25": "456",
    "KD-80i/25": "457",
    "KD-81/25": "458",
    "KD-82/25": "459",
    "KD-83/25": "460",
    "KD-84/25": "461",
    "KD-85/25": "462",
    "KD-86/25": "463",
    "KD-87/25": "464",
    "KD-88/25": "465",
    "KD-89/25": "466",
    
    # TURIZM 2-KURS
    "2 KURS": "472",
    "TU-11/24r": "473",
    "TU-12/24r": "474",
    "MR-11/24r": "475",
    "MR-12/24r": "476",
    "TU-51/24": "477",
    "TU-52/24": "478",
    "TU-53/24": "479",
    "TU-54/24": "480",
    "TU-55/24": "481",
    "TU-56/24": "482",
    "TU-57/24": "483",
    "MR-51/24": "484",
    "MR-52/24": "485",
    "MR-53/24": "486",
    "MR-54/24": "487",
    "MR-55/24": "488",
    "KD-51/24": "489",
    "KD-52/24": "490",
    "KD-53/24": "491",
    "MR-49/24i": "492",
    "MR-50/24i": "493",
    "TU-50/24i": "494",
    "KD-50/24i": "495",
    "KD-50K/24": "496",
    "KD-51k/24": "497",
    
    # TURIZM 3-KURS
    "3 KURS": "503",
    "TL-25/23r": "504",
    "TU-25/23r": "505",
    "MR-25/23r": "506",
    "TL-75/23": "507",
    "TU-75/23": "508",
    "TU-76/23": "509",
    "TM-75/23": "510",
    "MR-75/23": "511",
    "TU-70/23i": "512",
    "MR-70/23i": "513",
    "MR-26k/23": "514",
    "MR-27k/23": "515",
    
    # TURIZM 4-KURS
    "4 KURS": "516",
    "TL-01/22r": "517",
    "MR-01/22r": "518",
    "TL-60/22i": "519",
    "TU-60/22i": "520",
    "TU-61/22": "521",
    "TU-62/22": "522",
    "TU-63/22": "523",
    "TL-61/22": "524",
    "TM-61/22": "525",
    "MR-61/22": "526",
    "MRD-61/22": "527",
    "KD-61/22": "528",
    
    # QO'SHMA TA'LIM LLS
    "QO'SHMA TA'LIM LLS": "529",
    "ISEF Fall 2025": "530",
    "LSE-F/G1": "531",
    "LSE-F/G2": "532",
    "–ú–≠–ë-25": "533",
    
    # SOLIQ VA BUDJET HISOBI
    "SOLIQ VA BUDJET HISOBI": "534",
    "1 KURS": "535",
    "ST-80/25": "536",
    "ST-81/25": "537",
    "ST-82/25": "538",
    "ST-83/25": "539",
    "ST-84/25": "540",
    "ST-85/25": "541",
    "ST-86/25": "542",
    "ST-87/25": "543",
    "ST-88/25": "544",
    "ST-89/25": "545",
    "ST-80i/25": "547",
    "ST-30/25": "548",
    "ST-31/25": "549",
    "ST-32/25": "550",
    
    # SOLIQ 2-KURS
    "2 KURS": "557",
    "ST-01/24r": "558",
    "ST-02/24r": "559",
    "ST-50/24": "560",
    "ST-51/24": "561",
    "ST-52/24": "562",
    "ST-53/24": "563",
    "ST-54/24": "564",
    "ST-55/24": "565",
    "ST-56/24": "566",
    "ST-57/24": "567",
    "ST-50/24i": "568",
    "ST-51/24i": "569",
    
    # SOLIQ 3-KURS
    "3 KURS": "575",
    "ST-70/23": "576",
    "ST-71/23": "577",
    "ST-72/23": "578",
    "ST-73/23": "579",
    "ST-74/23": "580",
    "ST-75/23": "581",
    "ST-76/23": "582",
    "ST-77/23": "583",
    "ST-78/23": "584",
    "ST-20/23r": "585",
    "ST-21/23r": "586",
    "SS-70/23": "588",
    "SS-71/23": "589",
    "SS-72/23": "590",
    "SS-73/23": "591",
    "SS-74/23": "592",
    "SS-20/23r": "593",
    "BNG'-20/23r": "595",
    "BNG'-70/23": "596",
    "BNG'-71/23": "597",
    "BNG'-72/23": "598",
    "BNG'-73/23": "599",
    
    # SOLIQ 4-KURS
    "4 KURS": "604",
    "ST-60/22": "605",
    "ST-61/22": "606",
    "ST-62/22": "607",
    "ST-63/22": "608",
    "ST-64/22": "609",
    "ST-65/22": "610",
    "ST-66/22": "611",
    "ST-67/22": "612",
    "ST-68/22": "613",
    "ST-10/22r": "614",
    "ST-11/22r": "615",
    "ST-12/22r": "616",
    "SS-60/22": "617",
    "SS-61/22": "618",
    "SS-62/22": "619",
    "SS-63/22": "620",
    "SS-64/22": "621",
    "SS-10/22r": "622",
    "SS-11/22r": "623",
    "BNG'-10/22r": "624",
    "BNG'-60/22": "625",
    "BNG'-61/22": "626",
    "BNG'-63/22": "627",
    "BNG'-62/22i": "628",
    
    # BUXGALTERIYA HISOBI
    "BUXGALTERIYA HISOBI": "632",
    "1 KURS": "633",
    "BHA-80/25": "634",
    "BHA-81/25": "635",
    "BHA-82/25": "636",
    "BHA-83/25": "637",
    "BHA-86/25": "640",
    "BHA-87/25": "641",
    "BHA-88/25": "642",
    "BHA-89/25": "643",
    "BHA-80k/25": "644",
    "BHA-81k/25": "645",
    "BHA-82k/25": "646",
    "BHA-83k/25": "647",
    "BHA-30/25": "648",
    "BHA-31/25": "649",
    "BHA-32/25": "650",
    "BHA-33/25": "651",
    "BHA-34/25i": "652",
    "BHA-84/25i": "653",
    "BHA-85/25i": "654",
    
    # BUXGALTERIYA 2-KURS
    "2 KURS": "659",
    "BHA-01/24r": "660",
    "BHA-02/24r": "661",
    "BHA-03/24r": "662",
    "BHA-04/24r": "663",
    "BHA-50/24": "664",
    "BHA-51/24": "665",
    "BHA-52/24": "666",
    "BHA-53/24": "667",
    "BHA-54/24": "668",
    "BHA-55/24": "669",
    "BHA-56/24": "670",
    "BHA-57/24": "671",
    "BHA-58/24": "672",
    "BHA-59/24": "673",
    "BHA-50k/24": "674",
    "BHA-51k/24": "675",
    "BHA-55/24i": "676",
    "BHA-56/24i": "677",
    "BHA-05/24i": "678",
    
    # BUXGALTERIYA 3-KURS
    "3-KURS": "684",
    "BHA-70/23": "685",
    "BHA-71/23": "686",
    "BHA-72/23": "687",
    "BHA-73/23": "688",
    "BHA-74/23": "689",
    "BHA-76/23": "690",
    "BHA-77/23": "691",
    "BHA-78/23": "692",
    "BHA-70k/23i": "693",
    "BHA-71k/23i": "694",
    "BHA-75/23i": "695",
    "BHA-79/23": "696",
    "BHA-72k/23": "697",
    "BHA-73k/23": "698",
    "BHA-74k/23": "699",
    "BHA-20/23r": "700",
    "BHA-21/23r": "701",
    "BHA-22/23r": "702",
    "BHA-23/23r": "703",
    "BT-20/23r": "704",
    "BT-70/23": "705",
    "BT-71/23": "706",
    "BT-72/23": "707",
    
    # BUXGALTERIYA 4-KURS
    "4-KURS": "714",
    "BHA-60/22": "715",
    "BHA-61/22": "716",
    "BHA-62/22": "717",
    "BHA-63/22": "718",
    "BHA-64/22": "719",
    "BHA-66/22": "720",
    "BHA-67/22": "721",
    "BHA-68/22": "722",
    "BHA-60k/22": "723",
    "BHA-61k/22": "724",
    "BHA-62k/22": "725",
    "BHA-69/22i": "726",
    "BHA-65/22i": "727",
    "BHA-10/22r": "728",
    "BHA-11/22r": "729",
    "BHA-12/22r": "730",
    "BT-60/22": "731",
    "BT-61/22": "732",
    "BT-62/22": "733",
    
    # MOLIYA FAKULTETI
    "MOLIYA FAKULTETI": "738",
    "1-KURS": "739",
    "MMT-80/25": "740",
    "MMT-81/25": "741",
    "MMT-82/25": "742",
    "MMT-83/25": "743",
    "MMT-84/25": "744",
    "MMT-85/25": "745",
    "MMT-86/25": "746",
    "MMT-87/25": "747",
    "MMT-88/25": "748",
    "MMT-89/25": "749",
    "MMT-80k/25": "750",
    "MMT-81k/25": "751",
    "MMT-82k/25": "752",
    "MMT-83i/25": "753",
    "MMT-84i/25": "754",
    "MMT-30/25": "755",
    "MMT-31/25": "756",
    "MMT-32/25": "757",
    "MMT-33/25": "758",
    "MMT-34i/25": "759",
    
    # MOLIYA 2-KURS
    "2-KURS": "764",
    "MMT-50/24": "765",
    "MMT-51/24": "766",
    "MMT-52/24": "767",
    "MMT-53/24": "768",
    "MMT-54/24": "769",
    "MMT-55/24": "770",
    "MMT-56/24": "771",
    "MMT-57/24": "772",
    "MMT-58/24": "773",
    "MMT-59/24": "774",
    "MMT-50k/24": "775",
    "MMT-51i/24": "776",
    "MMT-52i/24": "777",
    "MMT-01/24": "778",
    "MMT-02/24": "779",
    "MMT-03/24": "780",
    "MMT-04/24": "781",
    
    # MOLIYA 3-KURS
    "3-KURS": "788",
    "MMT-70/23": "789",
    "MMT-71/23": "790",
    "MMT-72/23": "791",
    "MMT-73/23": "792",
    "MMT-74/23": "793",
    "MMT-75/23": "794",
    "MMT-76/23": "795",
    "MMT-77/23": "796",
    "MMT-78/23": "797",
    "MMT-70k/23": "798",
    "MMT-71k/23": "799",
    "MMT-72k/23": "800",
    "MMT-73i/23": "801",
    "MXVKM-70/23": "802",
    "MXVKM-71/23": "803",
    "MBI-70/23": "804",
    "MBI-71/23": "805",
    "MMT-20/23": "806",
    "MMT-21/23": "807",
    "MMT-22/23": "808",
    "MXVKM-20/23": "809",
    "MMT-79h/23": "810",
    
    # MOLIYA 4-KURS
    "4-KURS": "815",
    "MMT-60i/22": "816",
    "MMT-61i/22": "817",
    "MMT-62i/22": "818",
    "MMT-60/22": "819",
    "MMT-61/22": "820",
    "MMT-62/22": "821",
    "MMT-63/22": "822",
    "MMT-69h/22": "823",
    "MMT-64/22": "824",
    "MMT-65/22": "825",
    "MMT-66/22": "826",
    "MMT-67/22": "827",
    "MMT-68/22": "828",
    "MXVKM-60/22": "829",
    "MXVKM-61/22": "830",
    "MBI-60/22": "831",
    "MBI-61/22": "832",
    "MMT-10i/22": "833",
    "MMT-11/22": "834",
    "MMT-12/22": "835",
    "MXVKM-10/22": "836",
    
    # BANK ISHI FAKULTETI
    "BANK ISHI FAKULTETI": "843",
    "1-KURS": "844",
    "BIA-80/25": "845",
    "BIA-81/25": "846",
    "BIA-82/25": "847",
    "BIA-83/25": "848",
    "BIA-84/25": "849",
    "BIA-85/25": "850",
    "BIA-86/25": "851",
    "BIA-87/25": "852",
    "BIA-88/25": "853",
    "BIA-89/25": "854",
    "BIA-80k/25": "855",
    "BIA-30/25": "856",
    "BIA-32/25": "857",
    "BIA-33/25": "858",
    "BIA-80i/25": "859",
    "BIA-81i/25": "860",
    "BIA-31i/25": "861",
    
    # BANK ISHI 2-KURS
    "2-KURS": "866",
    "BIA-50/24": "867",
    "BIA-51/24": "868",
    "BIA-52/24": "869",
    "BIA-53/24": "870",
    "BIA-54/24": "871",
    "BIA-55/24": "872",
    "BIA-56/24": "873",
    "BIA-57/24": "874",
    "BIA-58/24": "875",
    "BIA-59/24": "876",
    "BIA-50i/24": "877",
    "BIA-51i/24": "878",
    "BIA-01/24r": "879",
    "BIA-02/24r": "880",
    "BIA-03/24r": "881",
    "BIA-04/24r": "882",
    
    # BANK ISHI 3-KURS
    "3-KURS": "889",
    "BIA-70/23": "890",
    "BIA-71/23": "891",
    "BIA-72/23": "892",
    "BIA-73/23": "893",
    "BIA-74/23": "894",
    "BIA-75/23i": "895",
    "BIA-76/23": "896",
    "BIA-77/23": "897",
    "BIA-78/23": "898",
    "BIA-79i/23": "899",
    "BIA-70k/23": "900",
    "BIA-71k/23": "901",
    "BIA-72k/23": "902",
    "BIA-73k/23": "903",
    "BBI-70/23": "904",
    "BBI-71/23": "905",
    "ILXKM-70/23": "906",
    "ILXKM-71/23": "907",
    "BIA-20/23r": "908",
    "BIA-21/23r": "909",
    "BIA-22/23r": "910",
    "BIA-23/23r": "911",
    "ILXKM-20/23r": "912",
    
    # BANK ISHI 4-KURS
    "4-KURS": "918",
    "BIA-60/22": "919",
    "BIA-61/22": "920",
    "BIA-62/22": "921",
    "BIA-63/22": "922",
    "BIA-64/22": "923",
    "BIA-65/22": "924",
    "BIA-66/22": "925",
    "BIA-60k/22": "926",
    "BIA-61k/22": "927",
    "BIA-62k/22": "928",
    "BIA-67i/22": "929",
    "BIA-68i/22": "930",
    "BBI-60/22": "931",
    "BBI-61/22": "932",
    "ILXKM-60/22": "933",
    "ILXKM-61/22": "934",
    "BIA-10/22r": "935",
    "BIA-11/22r": "936",
    "BIA-12/22r": "937",
    "ILXKM-10/22r": "938",
    
    # POLOTSKIY
    "POLOTSKIY": "942",
    "–°–§–§–§–¢-30-–ë-25-(26)": "943",
    "–°–§–§–§–¢-31-–ë-25-(26)": "944",
    "–°–§–ë–£–ê-30-25-(32)": "945",
    "–°–§–§–§–¢-30-–ß-25-(24)": "946",
    "–°–§–§–§–¢-31-–ß-25-(25)": "947",
    "–°–§–§–§–¢-32-–ß-25-(16)": "948",
    "–°–§–ë–£–ê-30-–ß-25-(21)": "949",
    "–°–§–§–§–¢-30-–ß–î-25-(23)": "950",
    "–°–§–ë–£–ê-30-–ß–î-25": "951",
    "PO12": "954",
    "PO17": "959",
    "–°–§–§–§–¢-50-–ë-24": "952",
    "–°–§–§–§–¢-51-–ë-24": "953",
    "PO29": "971",
    "–°–§–§–§–¢-13-–¢-23": "955",
    "–°–§–§–§–¢-10-–ë-23": "956",
    "–°–§–§–§–¢-11-–ë-23": "957",
    "–°–§–ë–£–ê-10-–ë-23": "958",
    "PO30": "972",
    "–°–§–ë–î–ê-20-–ë-22": "960",
    "–°–§–§–§–¢-20-–ë-22": "961",
    "–°–§–ë–£–ê-20-–ë-22": "962",
    "PO31": "973",
    "SFUI-01-B-25 (10)": "976",
    "SFBU-01-B-25 (10)": "977",
    "SFUI-01-CH-25 (20)": "978",
    "SFBU-01-CH-25": "979",
    "SFF-01-A-25": "980",
    "PO39": "981",
    "PO43": "985",
    "SFFFT-–ê-–¢Z-21": "982",
    "SFFFT-–í-–¢Z-21": "983",
    "SFBD–ê-–ê-–¢Z-21": "984",
    "PO44": "986",
    "PO45": "987",
    "PO46": "988",
    "PO47": "989",
    "PO48": "990",
    "PO49": "991",
    "PO50": "992",
    "PO51": "993",
    "PO52": "994",
    "PO53": "995",
    "PO54": "996",
    "PO55": "997",
    "PO56": "998",
    
    # MAGISTRATURA 1-KURS
    "MAGISTRATURA ‚Äî 1-KURS": "1030",
    "IN-25": "1031",
    "I-25": "1032",
    "MI-25": "1033",
    "IAT-25": "1034",
    "E-25": "1035",
    "IX-25": "1036",
    "RI-25": "1037",
    "BH-25": "1038",
    "A-25": "1039",
    "SST-25": "1040",
    "DMXM-25": "1041",
    "KMQQB-25": "1042",
    "IB-25": "1043",
    "DMNA-25": "1044",
    "BIA-25": "1045",
    "M-25": "1046",
    "MBA-25": "1047",
    "IRB-25": "1048",
    "JI-25": "1049",
    "TIF-25": "1050",
    "MRT-25": "1051",
    "T-25": "1052",
    "L-25": "1053",
    "BT-25": "1054",
    "XM-25": "1055",
    "BI-25": "1056",
    "SI-25": "1057",
    "BIR-25": "1058",
    "S-25": "1059",
    "MKD-25": "1060",
    "ET-25": "1061",
    "I-25R": "1063",
    "MI-25R": "1064",
    "BH-25R": "1065",
    "SST-25R": "1066",
    "DMXM-25R": "1067",
    "DMNA-25R": "1068",
    "BIA-25R": "1069",
    "M-25R": "1070",
    "MBA-25R": "1071",
    "JI-25R": "1072",
    "TIF-25R": "1073",
    "MRT-25R": "1074",
    "T-25R": "1075",
    "XM-25R": "1076",
    
    # MAGISTRATURA 2-KURS
    "MAGISTRATURA ‚Äî 2-KURS": "1080",
    "IN-15": "1081",
    "I-15": "1082",
    "I-16": "1083",
    "MI-15": "1084",
    "IAT-15": "1085",
    "E-15": "1086",
    "IX-15": "1087",
    "RI-15": "1088",
    "BH-15": "1089",
    "A-15": "1090",
    "SST-15": "1091",
    "BI-15": "1092",
    "DMXM-15": "1093",
    "DMXM-16": "1094",
    "KMQQB-15": "1095",
    "IB-15": "1096",
    "DMNA-15": "1097",
    "BIR-15": "1098",
    "BIA-15": "1099",
    "BT-15": "1100",
    "M-15": "1101",
    "KB-15": "1102",
    "MBA-15": "1103",
    "IRB-15": "1104",
    "JI-15": "1105",
    "TIF-15": "1106",
    "MRT-15": "1107",
    "SDI-15": "1108",
    "SNI-15": "1109",
    "T-15": "1110",
    "L-15": "1111",
    "SI-15": "1112",
    "ET-15": "1113",
    "I-15R": "1115",
    "MI-15R": "1116",
    "BH-15R": "1117",
    "SST-15R": "1118",
    "DMXM-15R": "1119",
    "BIA-15R": "1120",
    "M-15R": "1121",
    "MBA-15R": "1122",
    "JI-15R": "1123",
    "TIF-15R": "1124",
    "MRT-15R": "1125",
    "T-15R": "1126",
    
    # KECHKI 1-KURS
    "KECHKI ‚Äî 1-KURS": "1129",
    "KI-80/25": "1130",
    "KI-81/25": "1131",
    "KI-82/25": "1132",
    "KI-30/25r": "1133",
    "KBHA-80/25": "1134",
    "KBHA-30/25r": "1135",
    "KMMT-80/25": "1136",
    "KMMT-30/25r": "1137",
    "KBIA-80/25": "1138",
    "KBIA-30/25r": "1139",
    "KM-80/25": "1140",
    "KM-30/25r": "1141",
    "KBB-80/25": "1142",
    "KBB-81/25": "1143",
    "KIRB-80/25": "1144",
    "KIRB-81/25": "1145",
    
    # KECHKI 2-KURS
    "KECHKI ‚Äî 2-KURS": "1148",
    "KI-51/24": "1149",
    "KI-11/24r": "1150",
    "KBHA-51/24": "1151",
    "KBHA-11/24r": "1152",
    "KMMT-51/24": "1153",
    "KMMT-52/24": "1154",
    "KMMT-11/24r": "1155",
    "KBIA-51/24": "1156",
    "KBIA-11/24r": "1157",
    "KM-51/24": "1158",
    "KM-11/24r": "1159",
    "KBB-51/24": "1160",
    "KBB-52/24": "1161",
    "KIRB-51/24": "1162",
    "KIRB-52/24": "1163",
    
    # KECHKI 3-KURS
    "KECHKI ‚Äî 3-KURS": "1165",
    "KBIA-60/23": "1166",
    "KBIA-61/23": "1167",
    "KBIA-62/23": "1168",
    "KBIA-63/23": "1169",
    "KMMT-60/23": "1170",
    "KMMT-61/23": "1171",
    "KMMT-62/23": "1172",
    "KMMT-63/23": "1173",
    "KATT-60/23": "1174",
    "KATT-61/23": "1175",
    "KATT-62/23": "1176",
    "KBHA-60/23": "1177",
    "KBHA-61/23": "1178",
    "KBHA-62/23": "1179",
    "KBHA-63/23": "1180",
    "KI-60/23": "1181",
    "KI-61/23": "1182",
    "KI-62/23": "1183",
    "KI-63/23": "1184",
    "KM-60/23": "1185",
    "KM-61/23": "1186",
    
    # KECHKI 4-KURS
    "KECHKI ‚Äî 4-KURS": "1190",
    "KBIA-70/22": "1191",
    "KBIA-71/22": "1192",
    "KBIA-72/22": "1193",
    "KBIA-73/22": "1194",
    "KMMT-70/22": "1195",
    "KMMT-71/22": "1196",
    "KMMT-72/22": "1197",
    "KMMT-73/22": "1198",
    "KATT-70/22": "1199",
    "KATT-71/22": "1200",
    "KBHA-70/22": "1201",
    "KBHA-71/22": "1202",
    "KBHA-72/22": "1203",
    "KBHA-73/22": "1204",
    "KI-70/22": "1205",
    "KI-71/22": "1206",
    "KI-72/22": "1207",
    "KI-73/22": "1208",
    "KBIA-20/22r*": "1209",
    "KMMT-20/22r*": "1210",
    "KBHA-20/22r*": "1211",
    "KI-20/22r*": "1212",
    
    # MASOFAVIY TA`LIM
    "MASOFAVIY TA`LIM": "1215",
    
    # MASOFAVIY 2-KURS
    "2-KURS": "1216",
    "MBHA-51/24": "1217",
    "MBHA-52/24": "1218",
    "MBHA-53/24": "1219",
    "MIQT-51/24": "1220",
    "MIQT-52/24": "1221",
    "MIQT-53/24": "1222",
    "MMMT-51/24": "1223",
    "MMMT-52/24": "1224",
    "MMMT-53/24": "1225",
    "MBIA-51/24": "1226",
    "MBIA-52/24": "1227",
    "MBIA-53/24": "1228",
    "MMRT-51/24": "1229",
    "MMRT-52/24": "1230",
    "MMRT-53/24": "1231",
    "MBHA-11/24": "1232",
    "MIQT-11/24": "1233",
    "MMMT-11/24": "1234",
    "MBIA-11/24": "1235",
    "MMRT-11/24": "1236",
    
    # MASOFAVIY 3-KURS
    "MASOFAVIY TALIM ‚Äî 3-KURS": "1239",
    "MHBA-75/23": "1240",
    "MHBA-76/23": "1241",
    "MHBA-77/23": "1242",
    "MHBA-78/23": "1243",
    "MHBA-79/23": "1244",
    "MHBA-79A/23": "1245",
    "MMRT-75/23": "1246",
    "MIQT-75/23": "1247",
    "MIQT-76/23": "1248",
    "MIQT-77/23": "1249",
    "MIQT-78/23": "1250",
    "MIQT-79/23": "1251",
    "MHBA-25/23": "1252",
    "MHBA-26/23": "1253",
    "MMRT-25/23": "1254",
    "MIQT-25/23": "1255",
    "MIQT-26/23": "1256",
    
    # MASOFAVIY 4-KURS
    "MASOFAVIY TALIM ‚Äî 4-KURS": "1259",
    "MHBA-61/22": "1260",
    "MHBA-62/22": "1261",
    "MHBA-63/22": "1262",
    "MHBA-64/22": "1263",
    "MHBA-65/22": "1264",
    "MHBA-66/22": "1265",
    "MIQT-61/22": "1266",
    "MIQT-62/22": "1267",
    "MIQT-63/22": "1268",
    "MIQT-64/22": "1269",
    "MMRT-61/22": "1270",
    "MHBA-01/22": "1271",
    "MHBA-02/22": "1272",
    "MMRT-01/22": "1273",
    "MIQT-01/22": "1274",
    "MIQT-02/22": "1275",
    
    # MASOFAVIY 1-KURS
    "MASOFAVIY TALIM ‚Äî 1-KURS": "1278",
    "MIQT-80/25": "1279",
    "MIQT-81/25": "1280",
    "MIQT-82/25": "1281",
    "MIQT-83/25": "1282",
    "MIQT-84/25": "1283",
    "MIQT-85/25": "1284",
    "MIQT-86/25": "1285",
    "MIQT-87/25": "1286",
    "MIQT-88/25": "1287",
    "MIQT-89/25": "1288",
    "MBBA-80/25": "1289",
    "MBBA-81/25": "1290",
    "MBBA-82/25": "1291",
    "MIRB-80/25": "1292",
    "MIRB-81/25": "1293",
    "MIRB-82/25": "1294",
    "MIRB-83/25": "1295",
    "MMRT-80/25": "1296",
    "MMRT-81/25": "1297",
    "MMRT-82/25": "1298",
    "MMRT-83/25": "1299",
    "MMRT-84/25": "1300",
    "MTD-80/25": "1307",
    "MTD-81/25": "1308",
    "MTD-82/25": "1309",
    "MTD-83/25": "1310",
    "MTUR-80/25": "1311",
    "MTUR-81/25": "1312",
    "MTUR-82/25": "1313",
    "MTUR-83/25": "1314",
    "MTUR-84/25": "1315",
    "MTUR-85/25": "1316",
    "MLOG-80/25": "1318",
    "MLOG-81/25": "1319",
    "MLOG-82/25": "1320",
    "MLOG-83/25": "1321",
    "MBHA-80/25": "1322",
    "MBHA-81/25": "1323",
    "MBHA-82/25": "1324",
    "MBHA-83/25": "1325",
    "MBHA-84/25": "1326",
    "MBHA-85/25": "1327",
    "MBHA-86/25": "1328",
    "MBHA-87/25": "1329",
    "MBHA-88/25": "1330",
    "MBHA-89/25": "1331",
    "MST-80/25": "1332",
    "MST-81/25": "1333",
    "MST-82/25": "1334",
    "MST-83/25": "1335",
    "MST-84/25": "1336",
    "MST-85/25": "1337",
    "MMMT-80/25": "1338",
    "MMMT-81/25": "1339",
    "MMMT-82/25": "1340",
    "MMMT-83/25": "1341",
    "MMMT-84/25": "1342",
    "MMMT-85/25": "1343",
    "MMMT-86/25": "1344",
    "MMMT-87/25": "1345",
    "MMMT-88/25": "1346",
    "MMMT-89/25": "1347",
    "MBIA-80/25": "1348",
    "MBIA-81/25": "1349",
    "MBIA-82/25": "1350",
    "MBIA-83/25": "1351",
    "MBIA-84/25": "1352",
    "MBIA-85/25": "1353",
    "MBIA-86/25": "1354",
    "MBIA-87/25": "1355",
    "MRST-80/25": "1356",
    "MRST-81/25": "1357",
    "MRST-82/25": "1358",
    "MRST-83/25": "1359",
    "MMNP-80/25": "1360",
    "MMNP-81/25": "1361",
    "MMNP-82/25": "1362",
    "MMNP-83/25": "1363",
    "MMNP-30/25": "1364",
    "MMNP-31/25": "1365",
    "MBIA-30/25": "1366",
    "MBIA-31/25": "1367",
    "MIQT-30/25": "1368",
    "MIQT-31/25": "1369",
    "MBBA-30/25": "1370",
    "MMRT-30/25": "1371",
    "MTUR-30/25": "1374",
    "MTUR-31/25": "1375",
    "MBHA-30/25": "1376",
    "MBHA-31/25": "1377",
    "MST-30/25": "1378",
    "MST-31/25": "1379",
    "MMMT-30/25": "1380",
    "MMMT-31/25": "1381",
    "MBBA-83/25": "1382",
    "MBBA-84/25": "1383",
    
    # 2 TA'LIM 2‚ÄëKURS
    "2 TA'LIM 2‚ÄëKURS": "1541",
    "I-80-2/25": "1542",
    "I-81-2/25": "1543",
    "I-82-2/25": "1544",
    "I-83-2/25": "1545",
    "I-84-2/25": "1546",
    "I-85-2/25": "1547",
    "I-86-2/25": "1548",
    "I-87-2/25": "1549",
    "I-88-2/25": "1550",
    "I-89-2/25": "1551",
    "I-80A-2/25": "1552",
    "I-81A-2/25": "1553",
    "I-82A-2/25": "1554",
    "I-83A-2/25": "1555",
    "I-84A-2/25": "1556",
    "I-85A-2/25": "1557",
    "I-86A-2/25": "1558",
    "I-87A-2/25": "1559",
    "I-88A-2/25": "1560",
    "I-89A-2/25": "1561",
    "I-80B-2/25": "1562",
    "I-81B-2/25": "1563",
    "I-82B-2/25": "1564",
    "I-83B-2/25": "1565",
    "I-84B-2/25": "1566",
    "I-85B-2/25": "1567",
    "I-86B-2/25": "1568",
    "I-87B-2/25": "1569",
    "I-88B-2/25": "1570",
    "I-89B-2/25": "1571",
    "I-80–°-2/25": "1573",
    "I-81–°-2/25": "1574",
    "I-82–°-2/25": "1575",
    "I-83–°-2/25": "1576",
    "I-84–°-2/25": "1577",
    "I-85C-2/25": "1619",
    "I-31-2/25": "1578",
    "I-32-2/25": "1579",
    "I-33-2/25": "1580",
    "I-34-2/25": "1581",
    "I-35-2/25": "1582",
    "MMT-30-2/25": "1588",
    "MMT-31-2/25": "1589",
    "I-30-2/25": "1590",
    "BIA‚Äë80‚Äë2/25": "1591",
    "BIA‚Äë81‚Äë2/25": "1592",
    "BIA‚Äë82‚Äë2/25": "1593",
    "BIA‚Äë83‚Äë2/25": "1594",
    "BIA‚Äë84‚Äë2/25": "1595",
    "BIA‚Äë85‚Äë2/25": "1596",
    "BIA‚Äë86‚Äë2/25": "1597",
    "BIA‚Äë87‚Äë2/25": "1598",
    "BIA‚Äë88‚Äë2/25": "1599",
    "BIA‚Äë89‚Äë2/25": "1600",
    "BIA‚Äë30‚Äë2/25": "1601",
    "BIA‚Äë31‚Äë2/25": "1602",
    "BHA‚Äë80‚Äë2/25": "1603",
    "BHA‚Äë81‚Äë2/25": "1604",
    "BHA‚Äë82‚Äë2/25": "1605",
    "BHA‚Äë83‚Äë2/25": "1606",
    "BHA‚Äë84‚Äë2/25": "1607",
    "BHA‚Äë85‚Äë2/25": "1608",
    "BHA‚Äë30‚Äë2/25": "1610",
    "MMT‚Äë80‚Äë2/25": "1611",
    "MMT‚Äë81‚Äë2/25": "1612",
    "MMT‚Äë82‚Äë2/25": "1613",
    "MMT‚Äë83‚Äë2/25": "1614",
    "MMT‚Äë84‚Äë2/25": "1615",
    "MMT‚Äë85‚Äë2/25": "1616",
    "MMT‚Äë86‚Äë2/25": "1617",
    "MMT‚Äë87‚Äë2/25": "1618",
    
    # RI fakul`teti
    "RI fakul`teti": "1655",
    
    # 5-KURS SIRTQI
    "5-KURS SIRTQI": "1985",
    "MEK-41/21 rus": "1986",
    "MEK-42/21 rus": "1987",
    "MEK-91/21": "1988",
    "MEK-92/21": "1989",
    "MEK-93/21": "1990",
    "MEK-94/21": "1991",
    "MEK-95/21": "1992",
    "MEK-96/21": "1993",
    "MIRB-41/21 rus": "1994",
    "MIRB-91/21": "1995",
    "MMI-91/21": "1997",
    "5/EK-91/21": "1998",
    "5/EK-92/21": "1999",
    "5/EK-93/21": "2000",
    "5/EK-94/21": "2001",
    "5/BR-91/21": "2002",
    "5/BR-92/21": "2003",
    "5/BR-93/21": "2004",
    "5/MNP-91/21": "2005",
    "MBR-41/21 rus": "2006",
    "MBR-91/21": "2007",
    "MBR-92/21": "2008",
    "MBR-93/21": "2009",
    "MBR-94/21": "2010",
    "MBR-95/21": "2012",
    "MBR-96/21": "2013",
    "MBR-97/21": "2014",
    "MBR-98/21": "2015",
    "MBR-99/21": "2016",
    "MBN-91/21": "2017",
    "MSS-41/21 rus": "2018",
    "MSS-91/21": "2019",
    "MSS-92/21": "2020",
    "MSS-93/21": "2021",
    "MSS-94/21": "2022",
    "MMNP-41/21 rus": "2023",
    "MMNP-91/21": "2024",
    "MMNP-92/21": "2025",
    "MKB-91/21": "2026",
    "MMO-41/21 rus": "2028",
    "MMO-91/21": "2029",
    "MMO-92/21": "2030",
    "MKD-91/21": "2031",
    "MML-41/21 rus": "2032",
    "MML-91/21": "2033",
    "MMR-41/21 rus": "2034",
    "MMR-41/21 rus": "2035",
    "MMR-91/21": "2036",
    "MMR-92/21": "2037",
    "MMR-93/21": "2038",
    "MAT-41/21 rus": "2039",
    "MAT-91/21": "2040",
    "MAT-92/21": "2041",
    "MEKR-41/21 rus": "2042",
    "MEKR-91/21": "2043",
    "MIH-41/21 rus": "2045",
    "MIH-91/21": "2046",
    "MRI-41/21 rus": "2047",
    "MRI-91/21": "2048",
    "MST-41/21 rus": "2049",
    "MST-91/21": "2050",
    "MST-92/21": "2051",
    "MTL-41/21 rus": "2052",
    "MTL-91/21": "2053",
    "MTU-41/21 rus": "2054",
    "MTU-91/21": "2055",
    "MTU-92/21": "2056",
    "MTU-93/21": "2057",
    "MTU-94/21": "2058",
    
    # 2-KURS SIRTQI
    "2-KURS": "2060",
    "SI-01/24": "2061",
    "SI-02/24": "2062",
    "SI-03/24": "2063",
    "SI-04/24": "2067",
    "SBHA-01/24": "2068",
    "SBHA-02/24": "2069",
    "SBHA-03/24": "2070",
    "SMMT-01/24": "2072",
    "SMMT-02/24": "2073",
    "SMMT-03/24": "2074",
    "SMMT-04/24": "2075",
    "SBIA-01/24": "2076",
    "SBIA-02/24": "2077",
    "SBIA-03/24": "2078",
    "SI-50/24": "2081",
    "SI-51/24": "2082",
    "SI-52/24": "2084",
    "SI-53/24": "2085",
    "SI-54/24": "2086",
    "SI-55/24": "2087",
    "SI-56/24": "2088",
    "SI-57/24": "2089",
    "SI-58/24": "2090",
    "SI-59/24": "2091",
    "SI-59A/24": "2092",
    "SI-59B/24": "2093",
    "SI-59C/24": "2094",
    "SBHA-50/24": "2097",
    "SBHA-51/24": "2098",
    "SBHA-52/24": "2099",
    "SBHA-53/24": "2100",
    "SBHA-54/24": "2101",
    "SBHA-55/24": "2102",
    "SBHA-56/24": "2103",
    "SBHA-57/24": "2104",
    "SBHA-58/24": "2105",
    "SBHA-59/24": "2106",
    "SBHA-59K/24": "2107",
    "SBHA-59A/24": "2108",
    "SBHA-59B/24": "2109",
    "SMMT-50/24": "2111",
    "SMMT-51/24": "2112",
    "SMMT-52/24": "2113",
    "SMMT-53/24": "2114",
    "SMMT-54/24": "2115",
    "SMMT-55/24": "2116",
    "SMMT-56/24": "2117",
    "SMMT-57/24": "2118",
    "SMMT-58/24": "2119",
    "SMMT-59/24": "2120",
    "SMMT-59A/24": "2121",
    "SBIA-50/24": "2123",
    "SBIA-51/24": "2124",
    "SBIA-52/24": "2125",
    "SBIA-53/24": "2126",
    "SBIA-54/24": "2127",
    "SBIA-55/24": "2128",
    "SBIA-56/24": "2129",
}

# GROUPS_LIST ni GROUP_IDS dan yaratish
GROUPS_LIST = sorted(GROUP_IDS.keys())
print(f"‚úÖ {len(GROUP_IDS)} ta guruh ID yuklandi")


from playwright.sync_api import sync_playwright

def take_timetable_screenshot(guruh):
    try:
        url = f"{BASE_URL}{GROUP_IDS[guruh]}"
        file_path = f"/tmp/{guruh}.png"

        with sync_playwright() as p:
            browser = p.chromium.launch(headless=True)
            page = browser.new_page(viewport={"width": 1920, "height": 1080})
            page.goto(url, timeout=60000)
            page.wait_for_timeout(5000)
            
            # Edupage jadval elementini topish (bir nechta variant)
            selectors = [
                '.section',  # Edupage asosiy jadval konteyner
                '#main',
                'div.main',
                'div[class*="timetable"]',
                '.timetableContent',
                'table.main-table',
                'table'  # Oxirgi variant
            ]
            
            timetable = None
            for selector in selectors:
                timetable = page.query_selector(selector)
                if timetable:
                    break
            
            if timetable:
                timetable.screenshot(path=file_path)
            else:
                # Agar jadval topilmasa, butun sahifani olish
                page.screenshot(path=file_path, full_page=True)
            
            browser.close()

        return file_path, None

    except Exception as e:
        return None, str(e)


def start(update, context):
    """Start with language selection"""
    lang = context.user_data.get("lang")
    if not lang:
        return choose_language(update, context)
        
    s = STRINGS[lang]
    keyboard = [
        [KeyboardButton(s["btn_bugun"]), KeyboardButton(s["btn_guruh"])],
        [KeyboardButton(s["btn_notif"]), KeyboardButton(s["btn_lang"])],
        [KeyboardButton(s["btn_yordam"])],
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

    update.message.reply_text(
        s["welcome"],
        parse_mode="Markdown",
        reply_markup=reply_markup,
    )

def notif_menu_handler(update, context):
    """Notification settings menu"""
    lang = context.user_data.get("lang", "uz")
    s = STRINGS[lang]
    is_enabled = context.user_data.get("notif_enabled", False)
    status_text = s["notif_status_on"] if is_enabled else s["notif_status_off"]
    
    keyboard = [
        [KeyboardButton(s["btn_notif_on"]), KeyboardButton(s["btn_notif_off"])],
        [KeyboardButton(s["btn_back"])]
    ]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
    
    update.message.reply_text(
        s["notif_menu"].format(status_text),
        parse_mode="Markdown",
        reply_markup=reply_markup
    )

def daily_notification_callback(context):
    """Job callback to send daily schedules"""
    job = context.job
    chat_id = job.context['chat_id']
    user_data = context.dispatcher.user_data.get(chat_id, {})
    
    lang = user_data.get("lang", "uz")
    guruh = user_data.get("guruh")
    s = STRINGS[lang]
    
    if not guruh:
        return
        
    filepath, error = take_timetable_screenshot(guruh)
    if not error and filepath:
        try:
            kun = datetime.now().weekday()
            # Skip Sunday
            if kun == 6:
                return
                
            kun_nomi = s["days"][kun]
            caption = s["today_caption"].format(guruh, kun_nomi, f"{BASE_URL}{GROUP_IDS[guruh]}")
            
            with open(filepath, "rb") as photo:
                context.bot.send_photo(chat_id=chat_id, photo=photo, caption=caption, parse_mode="Markdown")
            os.remove(filepath)
        except Exception:
            pass

def update_notification_job(chat_id, context, enable=True):
    """Add or remove the notification job"""
    job_name = f"daily_notif_{chat_id}"
    current_jobs = context.job_queue.get_jobs_by_name(job_name)
    
    for job in current_jobs:
        job.schedule_removal()
        
    if enable:
        # Schedule daily at 08:00
        from datetime import time as dt_time
        target_time = dt_time(8, 0, 0)
        context.job_queue.run_daily(
            daily_notification_callback,
            time=target_time,
            days=(0, 1, 2, 3, 4, 5), # Mon-Sat
            name=job_name,
            context={"chat_id": chat_id}
        )

def choose_language(update, context):
    """Language selection menu"""
    keyboard = [
        [
            InlineKeyboardButton("üá∫üáø O'zbekcha", callback_data="lang_uz"),
            InlineKeyboardButton("üá∑üá∫ –†—É—Å—Å–∫–∏–π", callback_data="lang_ru"),
            InlineKeyboardButton("üá∫üá∏ English", callback_data="lang_en")
        ]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    msg_text = STRINGS["uz"]["choose_lang"]
    
    if update.callback_query:
        update.callback_query.message.reply_text(msg_text, reply_markup=reply_markup)
    else:
        update.message.reply_text(msg_text, reply_markup=reply_markup)

def guruh_tanlash(update, context):
    """Guruhlar"""
    lang = context.user_data.get("lang", "uz")
    s = STRINGS[lang]
    keyboard = []

    # Mashhur guruhlar
    popular = ["RST-88/25"]

    for g in popular:
        if g in GROUP_IDS:
            keyboard.append([
                InlineKeyboardButton(
                    f"{g}",
                    callback_data=f"g_{g}"
                )
            ])

    reply_markup = InlineKeyboardMarkup(keyboard)

    update.message.reply_text(
        s["select_group"],
        reply_markup=reply_markup,
        parse_mode="Markdown",
    )


def callback_handler(update, context):
    """Callback"""
    query = update.callback_query
    query.answer()
    
    data = query.data

    if data.startswith("lang_"):
        lang = data.split("_")[1]
        context.user_data["lang"] = lang
        s = STRINGS[lang]
        
        query.edit_message_text(s["lang_selected"])
        
        # Show main menu
        keyboard = [
            [KeyboardButton(s["btn_bugun"]), KeyboardButton(s["btn_guruh"])],
            [KeyboardButton(s["btn_yordam"]), KeyboardButton(s["btn_lang"])],
        ]
        reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)
        context.bot.send_message(
            chat_id=query.message.chat_id,
            text=s["welcome"],
            parse_mode="Markdown",
            reply_markup=reply_markup
        )

    elif data.startswith("g_"):
        guruh = data[2:]
        lang = context.user_data.get("lang", "uz")
        s = STRINGS[lang]
        context.user_data["guruh"] = guruh
        query.edit_message_text(
            s["group_selected"].format(guruh),
            parse_mode="Markdown",
        )


def bugun_handler(update, context):
    """Bugungi darslar - RASM bilan"""
    lang = context.user_data.get("lang", "uz")
    s = STRINGS[lang]
    guruh = context.user_data.get("guruh")

    if not guruh:
        update.message.reply_text(s["no_group"])
        return

    if guruh not in GROUP_IDS:
        update.message.reply_text(s["group_not_found"].format(guruh))
        return

    msg = update.message.reply_text(s["taking_screenshot"])

    # Screenshot olish
    filepath, error = take_timetable_screenshot(guruh)

    if error or not filepath:
        msg.edit_text(
            s["error_screenshot"].format(error) + f"\n{BASE_URL}{GROUP_IDS[guruh]}"
        )
        return

    try:
        kun = datetime.now().weekday()
        kun_nomi = s["days"][kun]

        caption = s["today_caption"].format(
            guruh,
            kun_nomi,
            f"{BASE_URL}{GROUP_IDS[guruh]}"
        )

        with open(filepath, "rb") as photo:
            update.message.reply_photo(
                photo=photo,
                caption=caption,
                parse_mode="Markdown",
            )

        msg.delete()

        try:
            os.remove(filepath)
        except Exception:
            pass

    except Exception as e:
        msg.edit_text(s["error_sending"].format(e))


def message_handler(update, context):
    """Messages"""
    text = update.message.text
    lang = context.user_data.get("lang", "uz")
    s = STRINGS[lang]

    # Check buttons in all languages to be safe
    all_bugun = [STRINGS[l]["btn_bugun"] for l in STRINGS]
    all_guruh = [STRINGS[l]["btn_guruh"] for l in STRINGS]
    all_yordam = [STRINGS[l]["btn_yordam"] for l in STRINGS]
    all_lang = [STRINGS[l]["btn_lang"] for l in STRINGS]
    all_notif = [STRINGS[l]["btn_notif"] for l in STRINGS]
    all_notif_on = [STRINGS[l]["btn_notif_on"] for l in STRINGS]
    all_notif_off = [STRINGS[l]["btn_notif_off"] for l in STRINGS]
    all_back = [STRINGS[l]["btn_back"] for l in STRINGS]

    if text in all_bugun:
        bugun_handler(update, context)
        
    elif text in all_guruh:
        guruh_tanlash(update, context)
        
    elif text in all_notif:
        notif_menu_handler(update, context)
        
    elif text in all_notif_on:
        context.user_data["notif_enabled"] = True
        update_notification_job(update.message.chat_id, context, enable=True)
        update.message.reply_text(s["notif_enabled"])
        start(update, context)
        
    elif text in all_notif_off:
        context.user_data["notif_enabled"] = False
        update_notification_job(update.message.chat_id, context, enable=False)
        update.message.reply_text(s["notif_disabled"])
        start(update, context)
        
    elif text in all_back:
        start(update, context)

    elif text in all_yordam:
        update.message.reply_text(
            s["help_text"],
            parse_mode="Markdown",
        )
        
    elif text in all_lang:
        choose_language(update, context)

    else:
        # Guruh nomini tekshirish
        user_text = text.strip().upper()

        for g in GROUP_IDS.keys():
            if g.upper() == user_text:
                context.user_data["guruh"] = g
                update.message.reply_text(
                    s["group_selected"].format(g),
                    parse_mode="Markdown",
                )
                return

        # Default welcome message if not a group
        update.message.reply_text(
            s["welcome"],
            parse_mode="Markdown",
        )



def main():
    print("============================================================")
    print("üéì TSUE Jadval Bot")
    print(f"üìä {len(GROUP_IDS)} ta guruh/element")
    print("üì∏ Screenshot rejimi")
    print("============================================================")

    from telegram.ext import PicklePersistence
    persistence = PicklePersistence(filename='bot_data.pickle')

    updater = Updater(BOT_TOKEN, use_context=True, persistence=persistence)
    dp = updater.dispatcher

    # Restart jobs for users who have them enabled
    job_queue = updater.job_queue
    def restore_jobs(dispatcher):
        chat_ids = dispatcher.user_data.keys()
        for chat_id in chat_ids:
            u_data = dispatcher.user_data.get(chat_id, {})
            if u_data.get("notif_enabled", False):
                # Manual job reconstruction since objects aren't persisted well
                job_name = f"daily_notif_{chat_id}"
                from datetime import time as dt_time
                target_time = dt_time(8, 0, 0)
                job_queue.run_daily(
                    daily_notification_callback,
                    time=target_time,
                    days=(0, 1, 2, 3, 4, 5),
                    name=job_name,
                    context={"chat_id": chat_id}
                )

    dp.add_handler(CommandHandler("start", start))
    dp.add_handler(CommandHandler("guruh", guruh_tanlash))
    dp.add_handler(CallbackQueryHandler(callback_handler))
    dp.add_handler(MessageHandler(Filters.text & ~Filters.command, message_handler))

    print("‚úÖ Ishga tushdi!")
    
    # Restore jobs after start
    restore_jobs(dp)
    
    updater.start_polling()
    updater.idle()


if __name__ == "__main__":
    main()